package co.blocke.scalajack
package yaml
package mapkeys

import org.scalatest.matchers.should.Matchers
import org.scalatest.funspec.AnyFunSpec

class ScalaPrimKeys() extends AnyFunSpec with Matchers {

  val sj = ScalaJack(YamlFlavor())

  describe(
    "-----------------------------------\n:  Scala Primitive Map Key Tests  :\n-----------------------------------"
  ) {
    describe("+++ Positive Tests +++") {
      it("With Any Key") {
        val inst = AnyShell(
          Map(
            List(1, 2, 3)                -> List("a", "b", "c"),
            DogPet("Fido", Food.Meat, 4) -> DogPet("Fifi", Food.Meat, 4),
            Size.Small                   -> "ok",
            123.456                      -> true,
            293845                       -> "Greg",
            false                        -> "16",
            "Fred"                       -> "Wilma",
            16.toByte                    -> null
          )
        )
        val yaml = sj.render(inst)
        println(yaml)
        /*
        parseJValue(yaml) should matchJson(
          parseJValue(
            """{"m":{"false":"16","Small":"ok","123.456":true,"{\"_hint\":\"co.blocke.scalajack.yamlon.mapkeys.DogPet\",\"name\":\"Fido\",\"food\":\"Meat\",\"numLegs\":4}":{"_hint":"co.blocke.scalajack.yamlon.mapkeys.DogPet","name":"Fifi","food":"Meat","numLegs":4},"Fred":"Wilma","[1,2,3]":["a","b","c"],"293845":"Greg","16":null}}"""
          )
        )
        val read =
          sj.read[AnyShell](yaml).m.keySet.map(z => (z, z.getClass.getName))
        read.contains((16, "java.lang.Integer")) should be(true)
        read.contains((293845, "java.lang.Integer")) should be(true)
        read.contains((123.456, "java.lang.Double")) should be(true)
        read.contains(("Small", "java.lang.String")) should be(true)
        read.contains(("Fred", "java.lang.String")) should be(true)
        read.contains((false, "java.lang.Boolean")) should be(true)
        read.contains(
          (
            DogPet("Fido", Food.Meat, 4),
            "co.blocke.scalajack.yamlon.mapkeys.DogPet"
          )
        ) should be(true)

       */
      }
      /*
      it("With BigDecimal Key") {
        val inst = SampleBigDecimal(
          Map(
            BigDecimal(123.456) -> BigDecimal(1),
            BigDecimal(789.123) -> BigDecimal(2)
          )
        )
        val yaml = sj.render(inst)
        assertResult("""{"m":{"123.456":1,"789.123":2}}""") { yaml }
        assertResult(inst) {
          sj.read[SampleBigDecimal](yaml)
        }
      }
      it("With BigInt Key") {
        val inst =
          SampleBigInt(Map(BigInt(123) -> BigInt(1), BigInt(789) -> BigInt(2)))
        val yaml = sj.render(inst)
        assertResult("""{"m":{"123":1,"789":2}}""") { yaml }
        assertResult(inst) {
          sj.read[SampleBigInt](yaml)
        }
      }
      it("With Boolean Key") {
        val inst = SampleBoolean(Map(true -> false, false -> true))
        val yaml   = sj.render(inst)
        assertResult("""{"m":{"true":false,"false":true}}""") { yaml }
        assertResult(inst) {
          sj.read[SampleBoolean](yaml)
        }
      }
      it("With Byte Key") {
        val inst = SampleByte(Map(16.toByte -> 2.toByte, 48.toByte -> 9.toByte))
        val yaml   = sj.render(inst)
        assertResult("""{"m":{"16":2,"48":9}}""") { yaml }
        assertResult(inst) {
          sj.read[SampleByte](yaml)
        }
      }
      it("With Char Key") {
        val inst = SampleChar(Map('a' -> 'A', 'z' -> 'Z'))
        val yaml   = sj.render(inst)
        assertResult("""{"m":{"a":"A","z":"Z"}}""") { yaml }
        assertResult(inst) {
          sj.read[SampleChar](yaml)
        }
      }
      it("With Double Key") {
        val inst = SampleDouble(Map(12.34 -> 56.78, 90.12 -> 34.56))
        val yaml   = sj.render(inst)
        assertResult("""{"m":{"12.34":56.78,"90.12":34.56}}""") { yaml }
        assertResult(inst) {
          sj.read[SampleDouble](yaml)
        }
      }
      it("With Enumeration Key") {
        val inst = SampleEnumeration(
          Map(Size.Small -> Size.Large, Size.Large -> Size.Medium)
        )
        val yaml = sj.render(inst)
        assertResult("""{"m":{"Small":"Large","Large":"Medium"}}""") { yaml }
        assertResult(inst) {
          sj.read[SampleEnumeration](yaml)
        }
      }
      it("With Float Key") {
        val inst = SampleFloat(Map(12.34F -> 56.78F, 90.12F -> 34.56F))
        val yaml   = sj.render(inst)
        assertResult("""{"m":{"12.34":56.78,"90.12":34.56}}""") { yaml }
        assertResult(inst) {
          sj.read[SampleFloat](yaml)
        }
      }
      it("With Int Key") {
        val inst = SampleInt(Map(12 -> 56, 90 -> 34))
        val yaml   = sj.render(inst)
        assertResult("""{"m":{"12":56,"90":34}}""") { yaml }
        assertResult(inst) {
          sj.read[SampleInt](yaml)
        }
      }
      it("With Long Key") {
        val inst = SampleLong(Map(12L -> 56L, 90L -> 34L))
        val yaml   = sj.render(inst)
        assertResult("""{"m":{"12":56,"90":34}}""") { yaml }
        assertResult(inst) {
          sj.read[SampleLong](yaml)
        }
      }
      it("With Short Key") {
        val inst =
          SampleShort(Map(12.toShort -> 56.toShort, 90.toShort -> 34.toShort))
        val yaml = sj.render(inst)
        assertResult("""{"m":{"12":56,"90":34}}""") { yaml }
        assertResult(inst) {
          sj.read[SampleShort](yaml)
        }
      }
     */
    }
    describe("--- Negative Tests ---") {
      /*
      it("Bad BigDecimal Key") {
        val yaml  = """{"m":{"789.123":1,"fred":2}}"""
        val msg = """Expected a Number here
                    |fred
                    |^""".stripMargin
        the[ScalaJackError] thrownBy sj.read[SampleBigDecimal](yaml) should have message msg
      }
      it("Bad BigInt Key") {
        val yaml  = """{"m":{"fred":1,"789":2}}"""
        val msg = """Expected a Number here
                    |fred
                    |^""".stripMargin
        the[ScalaJackError] thrownBy sj.read[SampleBigInt](yaml) should have message msg
      }
      it("Bad Boolean Key") {
        val yaml  = """{"m":{"true":false,"123":true}}"""
        val msg = """Expected a Boolean here
                    |123
                    |^""".stripMargin
        the[ScalaJackError] thrownBy sj.read[SampleBoolean](yaml) should have message msg
      }
      it("Bad Byte Key") {
        val yaml  = """{"m":{"16":2,"x48":9}}"""
        val msg = """Expected a Number here
                    |x48
                    |^""".stripMargin
        the[ScalaJackError] thrownBy sj.read[SampleByte](yaml) should have message msg
      }
      it("Bad Char Key") { // NOTE: This comprehensively tests for any null keyed Map
        val yaml  = """{"m":{null:"A","z":"Z"}}"""
        val msg = """A Char typed value cannot be null
                    |{"m":{null:"A","z":"Z"}}
                    |---------^""".stripMargin
        the[ScalaJackError] thrownBy sj.read[SampleChar](yaml) should have message msg
      }
      it("Bad Double Key") {
        val yaml  = """{"m":{"12.34":56.78,"true":34.56}}"""
        val msg = """Expected a Number here
                    |true
                    |^""".stripMargin
        the[ScalaJackError] thrownBy sj.read[SampleDouble](yaml) should have message msg
      }
      it("Bad Enumeration Key") {
        val yaml = """{"m":{"Small":"Large","Bogus":"Medium"}}"""
        val msg =
          """No value found in enumeration co.blocke.scalajack.yamlon.mapkeys.Size$ for Bogus
            |{"m":{"Small":"Large","Bogus":"Medium"}}
            |----------------------------^""".stripMargin
        the[ScalaJackError] thrownBy sj
          .read[SampleEnumeration](yaml) should have message msg
      }
      it("Bad Float Key") {
        val yaml  = """{"m":{"12.34":56.78,"90.12.3":34.56}}"""
        val msg = """Cannot parse an Float from value
                    |90.12.3
                    |------^""".stripMargin
        the[ScalaJackError] thrownBy sj.read[SampleFloat](yaml) should have message msg
      }
      it("Bad Int Key") {
        val yaml  = """{"m":{"12.0":56,"90":34}}"""
        val msg = """Cannot parse an Int from value
                    |12.0
                    |---^""".stripMargin
        the[ScalaJackError] thrownBy sj.read[SampleInt](yaml) should have message msg
      }
      it("Bad Long Key") {
        val yaml  = """{"m":{"12":56,"hey":34}}"""
        val msg = """Expected a Number here
                    |hey
                    |^""".stripMargin
        the[ScalaJackError] thrownBy sj.read[SampleLong](yaml) should have message msg
      }
      it("Bad Short Key") {
        val yaml  = """{"m":{"p99999":56,"90":34}}"""
        val msg = """Expected a Number here
                    |p99999
                    |^""".stripMargin
        the[ScalaJackError] thrownBy sj.read[SampleShort](yaml) should have message msg
      }
     */
    }
  }
}
